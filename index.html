<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DAE - Digital Assistant for Energy</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Leaflet for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        /* ========== CSS VARIABLES - DAE BRANDING ========== */
        :root {
            /* DAE Brand Colors - Enhanced Vibrant Palette */
            --dae-primary: #3B82F6;
            --dae-primary-dark: #1E40AF;
            --dae-primary-light: #60A5FA;
            --dae-accent: #F59E0B;
            --dae-teal: #06B6D4;
            --dae-coral: #F43F5E;
            --dae-purple: #A855F7;
            --dae-success: #10B981;
            --dae-warning: #F59E0B;
            --dae-error: #EF4444;

            /* Glassmorphism */
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.3);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --glass-blur: blur(16px);

            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #3B82F6 0%, #06B6D4 100%);
            --gradient-success: linear-gradient(135deg, #06B6D4 0%, #10B981 100%);
            --gradient-warm: linear-gradient(135deg, #F59E0B 0%, #F43F5E 100%);
            --gradient-purple: linear-gradient(135deg, #A855F7 0%, #3B82F6 100%);

            /* Neutral Colors */
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;

            /* Typography */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-base: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            --font-size-2xl: 24px;
            --font-size-3xl: 32px;
            --font-size-4xl: 40px;

            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;

            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);

            /* Animations */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ========== RESET & BASE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            line-height: 1.5;
            color: var(--gray-900);
            background: linear-gradient(135deg, #EBF4FF 0%, #E0F2FE 50%, #F0FDFA 100%);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow: hidden;
        }

        /* ========== GLASSMORPHISM BASE ========== */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        .glass-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-hover:hover {
            background: rgba(255, 255, 255, 0.85);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .glass-hover:active {
            transform: translateY(0);
            box-shadow: var(--glass-shadow);
        }

        /* ========== MOBILE CONTAINER ========== */
        .mobile-container {
            width: 100%;
            max-width: 430px;
            height: 100vh;
            margin: 0 auto;
            background: white;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.15);
        }

        /* ========== STATUS BAR (iOS Style) ========== */
        .status-bar {
            height: 54px;
            background: var(--dae-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--space-md);
            padding-top: env(safe-area-inset-top, 10px);
            color: white;
            font-size: var(--font-size-sm);
            font-weight: 500;
        }

        .status-bar .carrier {
            font-size: 15px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .status-bar .indicators {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .status-bar .signal-bars {
            display: flex;
            gap: 2px;
            align-items: flex-end;
            height: 14px;
        }

        .status-bar .signal-bar {
            width: 3px;
            background: white;
            border-radius: 1px;
        }

        .status-bar .signal-bar:nth-child(1) {
            height: 4px;
        }

        .status-bar .signal-bar:nth-child(2) {
            height: 7px;
        }

        .status-bar .signal-bar:nth-child(3) {
            height: 10px;
        }

        .status-bar .signal-bar:nth-child(4) {
            height: 13px;
        }

        .status-bar .wifi-icon {
            font-size: 14px;
        }

        .status-bar .battery {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 15px;
            font-weight: 600;
        }

        .status-bar .battery i {
            font-size: 16px;
        }

        /* ========== SCREENS ========== */
        .screen {
            display: none;
            flex: 1;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .screen.active {
            display: flex;
        }

        /* ========== WELCOME / SPLASH SCREEN ========== */
        .welcome-screen {
            background: linear-gradient(135deg, var(--dae-primary) 0%, var(--dae-teal) 100%);
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: var(--space-xl);
        }

        .welcome-logo {
            width: 120px;
            height: 120px;
            margin-bottom: var(--space-lg);
            animation: fadeInScale 0.6s ease-out;
        }

        .welcome-title {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            margin-bottom: var(--space-sm);
            letter-spacing: -0.5px;
        }

        .welcome-subtitle {
            font-size: var(--font-size-lg);
            opacity: 0.9;
            margin-bottom: var(--space-2xl);
            font-weight: 400;
        }

        .btn-start {
            background: white;
            color: var(--dae-primary);
            padding: 18px 48px;
            border-radius: 28px;
            font-size: var(--font-size-lg);
            font-weight: 600;
            border: none;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: transform var(--transition-fast);
        }

        .btn-start:active {
            transform: scale(0.96);
        }

        /* ========== HOME SCREEN ========== */
        .home-screen {
            background: transparent;
        }

        .home-header {
            background: var(--gradient-primary);
            color: white;
            padding: var(--space-lg) var(--space-md) var(--space-xl);
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
            box-shadow: 0 4px 24px rgba(59, 130, 246, 0.3);
        }

        .home-header-top {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .home-driver-avatar {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.5);
            flex-shrink: 0;
        }

        .home-driver-info {
            flex: 1;
        }

        .home-driver-name {
            font-size: var(--font-size-xl);
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .home-greeting {
            font-size: var(--font-size-sm);
            opacity: 0.8;
        }

        .home-vehicle-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .vehicle-image {
            width: 80px;
            flex-shrink: 0;
        }

        .vehicle-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .vehicle-details .registration {
            font-size: var(--font-size-base);
            font-weight: 700;
        }

        .vehicle-details .vehicle-model {
            font-size: var(--font-size-xs);
            opacity: 0.8;
        }

        .home-content {
            padding: var(--space-md);
            flex: 1;
        }

        /* Quick Stats Card */
        .quick-stats-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: var(--glass-shadow);
            margin-top: -32px;
            position: relative;
            z-index: 10;
            animation: slideUpFade 0.5s ease-out;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md) 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--gray-600);
        }

        .stat-value {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--dae-teal);
        }

        .stat-value.large {
            font-size: var(--font-size-3xl);
            background: linear-gradient(135deg, var(--dae-teal) 0%, var(--dae-primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-row.fuel-available {
            flex-wrap: wrap;
            gap: 8px;
        }

        .stat-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .fuel-bar-container {
            width: 100%;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .fuel-bar {
            height: 100%;
            background: linear-gradient(90deg, #10B981 0%, #06B6D4 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .fuel-percentage {
            font-size: var(--font-size-xs);
            font-weight: 600;
            color: #10B981;
        }

        .fuel-type {
            display: flex;
            align-items: center;
        }

        /* Primary Action Button */
        .action-card {
            background: linear-gradient(135deg, var(--dae-teal) 0%, var(--dae-primary) 100%);
            border-radius: 20px;
            padding: var(--space-xl);
            margin-bottom: var(--space-lg);
            color: white;
            text-align: center;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: transform var(--transition-fast);
        }

        .action-card:active {
            transform: scale(0.98);
        }

        .action-icon {
            width: 64px;
            height: 64px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-md);
            font-size: 32px;
        }

        .action-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--space-sm);
        }

        .action-subtitle {
            font-size: var(--font-size-base);
            opacity: 0.9;
        }

        /* Map Section */
        .map-section {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 0.5px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            box-shadow: var(--glass-shadow);
            margin-bottom: var(--space-lg);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .section-title {
            font-size: var(--font-size-base);
            font-weight: 700;
            color: #000000;
            letter-spacing: -0.012em;
        }

        .see-all-link {
            color: #007AFF;
            font-size: var(--font-size-sm);
            text-decoration: none;
            font-weight: 600;
        }

        #map {
            height: 180px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: var(--space-md);
        }

        /* Station List - iOS Pattern */
        .station-item {
            display: flex;
            align-items: center;
            padding: var(--space-md) 0;
            cursor: pointer;
            transition: opacity 0.2s ease;
            border-bottom: 0.5px solid rgba(0, 0, 0, 0.1);
        }

        .station-item:last-child {
            border-bottom: none;
        }

        .station-item:active {
            opacity: 0.6;
        }

        .station-icon {
            width: 44px;
            height: 44px;
            background: #F2F2F7;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #007AFF;
            font-size: 18px;
            margin-right: var(--space-md);
            flex-shrink: 0;
        }

        .station-logo {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: var(--space-md);
            flex-shrink: 0;
            background: white;
            border-radius: var(--radius-md);
            overflow: hidden;
            padding: 4px;
        }

        .station-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .station-details {
            flex: 1;
        }

        .station-name {
            font-weight: 600;
            font-size: var(--font-size-base);
            color: #000000;
            margin-bottom: 2px;
            letter-spacing: -0.01em;
        }

        .station-distance {
            font-size: var(--font-size-sm);
            color: #8E8E93;
        }

        .station-arrow {
            color: #C7C7CC;
            font-size: 14px;
        }

        .station-amenities {
            display: flex;
            gap: 4px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .amenity-icon {
            width: 22px;
            height: 22px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            background: #F2F2F7;
            color: #8E8E93;
        }

        .amenity-restaurant {
            background: #FEF3C7;
            color: #D97706;
        }

        .amenity-surau {
            background: #DBEAFE;
            color: #2563EB;
        }

        .amenity-atm {
            background: #D1FAE5;
            color: #059669;
        }

        .amenity-fuel {
            background: #FCE7F3;
            color: #DB2777;
        }

        .amenity-parking {
            background: #E0E7FF;
            color: #6366F1;
        }

        .amenity-shower {
            background: #CFFAFE;
            color: #0891B2;
        }

        /* ========== NFC TAP SCREEN ========== */
        .nfc-screen {
            background: transparent;
            justify-content: center;
            align-items: center;
            padding: var(--space-xl);
            text-align: center;
        }

        .nfc-animation {
            width: 180px;
            height: 180px;
            position: relative;
            margin: 0 auto var(--space-xl);
        }

        .nfc-pulse {
            width: 100%;
            height: 100%;
            border: 4px solid var(--dae-primary);
            border-radius: 50%;
            position: absolute;
            animation: pulse 2s infinite;
        }

        .nfc-pulse:nth-child(2) {
            animation-delay: 0.5s;
        }

        .nfc-pulse:nth-child(3) {
            animation-delay: 1s;
        }

        .nfc-icon {
            width: 100px;
            height: 100px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 48px;
            z-index: 10;
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
        }

        @keyframes pulse {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }

            100% {
                transform: scale(1.4);
                opacity: 0;
            }
        }

        .nfc-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-md);
        }

        .nfc-instruction {
            font-size: var(--font-size-lg);
            color: var(--gray-600);
            line-height: 1.6;
            margin-bottom: var(--space-lg);
        }

        .nfc-illustration {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: var(--glass-shadow);
        }

        .nfc-illustration img {
            width: 100%;
            max-width: 280px;
            height: auto;
        }

        .nfc-tip {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border-left: 4px solid var(--dae-accent);
            padding: var(--space-md);
            border-radius: 12px;
            text-align: left;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }

        .nfc-tip-title {
            font-weight: 600;
            color: #92400E;
            margin-bottom: var(--space-xs);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .nfc-tip-text {
            font-size: var(--font-size-sm);
            color: #78350F;
            line-height: 1.5;
        }

        /* ========== LOADING SCREEN ========== */
        .loading-screen {
            background: linear-gradient(180deg, #EBF4FF 0%, #FFFFFF 100%);
            justify-content: center;
            align-items: center;
            padding: var(--space-xl);
            text-align: center;
        }

        .loading-fleet-graphic {
            margin: 0 auto var(--space-lg);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--gray-200);
            border-top-color: var(--dae-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-md);
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-md);
        }

        .loading-message {
            font-size: var(--font-size-base);
            color: var(--gray-600);
            margin-bottom: var(--space-sm);
        }

        .motivational-message {
            font-size: var(--font-size-sm);
            color: var(--dae-primary);
            font-weight: 500;
            font-style: italic;
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* ========== QR CODE SCREEN ========== */
        .qr-screen {
            background: transparent;
            padding: var(--space-lg);
        }

        .qr-header {
            text-align: center;
            padding: var(--space-xl) 0;
        }

        .qr-status {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            color: #D97706;
            padding: var(--space-sm) var(--space-lg);
            border-radius: 24px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            margin-bottom: var(--space-md);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
            animation: pulse-subtle 2s ease-in-out infinite;
        }

        @keyframes pulse-subtle {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }
        }

        .qr-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-sm);
        }

        .qr-subtitle {
            font-size: var(--font-size-base);
            color: var(--gray-600);
        }

        /* ========== ENERGY FLOW: QR SCREEN ========== */
        .qr-code-container {
            background: white;
            border: 0.5px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            margin: var(--space-lg) 0;
            text-align: center;
        }

        .qr-timer-ring {
            width: 72px;
            height: 72px;
            position: relative;
            margin: 0 auto var(--space-lg);
        }

        .qr-timer-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid #F2F2F7;
            border-top-color: #007AFF;
            animation: spin 8s linear infinite;
        }

        .qr-timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: #000000;
        }

        .qr-code {
            width: 240px;
            height: 240px;
            margin: 0 auto var(--space-lg);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 0.5px solid rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            padding: var(--space-md);
        }

        .qr-txn-id {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            font-weight: 700;
            color: #000000;
            letter-spacing: 0.05em;
        }

        .qr-details {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
            border: 0.5px solid rgba(0, 0, 0, 0.05);
        }

        .qr-detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 0.5px solid rgba(0, 0, 0, 0.05);
        }

        .qr-detail-row:last-child {
            border-bottom: none;
        }

        .qr-detail-label {
            font-size: var(--font-size-sm);
            color: #8E8E93;
            font-weight: 500;
        }

        .qr-detail-value {
            font-size: var(--font-size-sm);
            font-weight: 700;
            color: #000000;
        }

        .qr-instruction-box {
            background: #000000;
            color: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
        }

        .btn-cancel {
            width: 100%;
            padding: 16px;
            background: transparent;
            color: #FF3B30;
            border: none;
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            margin-top: var(--space-md);
        }

        /* ========== ENERGY FLOW: APPROVAL SCREEN ========== */
        .approval-screen {
            background: #F2F2F7;
            padding: var(--space-md);
        }

        .approval-header {
            background: #000000;
            color: white;
            padding: var(--space-2xl) var(--space-md) var(--space-xl);
            border-bottom-left-radius: var(--radius-xl);
            border-bottom-right-radius: var(--radius-xl);
            text-align: center;
            margin: -20px -20px var(--space-lg);
        }

        .approval-icon {
            width: 80px;
            height: 80px;
            background: #34C759;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-lg);
        }

        .approval-icon i {
            font-size: 40px;
            color: white;
        }

        .approval-title {
            font-size: var(--font-size-2xl);
            font-weight: 800;
            letter-spacing: -0.03em;
            margin-bottom: 4px;
        }

        .approval-message {
            font-size: var(--font-size-sm);
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .approval-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            border: 0.5px solid rgba(0, 0, 0, 0.05);
        }

        .approval-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg) 0;
            border-bottom: 0.5px solid rgba(0, 0, 0, 0.05);
        }

        .approval-detail:last-child {
            border-bottom: none;
        }

        .approval-label {
            font-size: var(--font-size-base);
            color: #8E8E93;
            font-weight: 500;
        }

        .approval-value {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: #000000;
            letter-spacing: -0.02em;
        }

        .btn-proceed {
            width: 100%;
            padding: 18px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 16px;
            font-size: var(--font-size-lg);
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .btn-proceed:active {
            opacity: 0.7;
        }

        /* ========== RECEIPT SCREEN ========== */
        .receipt-screen {
            background: transparent;
            padding: var(--space-lg);
        }

        .receipt-header {
            text-align: center;
            padding: var(--space-xl) 0;
        }

        .receipt-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient-success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-md);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
        }

        .receipt-icon i {
            font-size: 40px;
            color: white;
        }

        .receipt-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-sm);
        }

        .receipt-subtitle {
            font-size: var(--font-size-base);
            color: var(--gray-600);
        }

        .receipt-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: var(--space-xl);
            box-shadow: var(--glass-shadow);
            margin-bottom: var(--space-lg);
        }

        .receipt-section {
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-lg);
            border-bottom: 2px dashed var(--gray-200);
        }

        .receipt-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .receipt-section-title {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-md);
        }

        .receipt-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) 0;
        }

        .receipt-label {
            font-size: var(--font-size-sm);
            color: var(--gray-600);
        }

        .receipt-value {
            font-size: var(--font-size-base);
            font-weight: 600;
            color: var(--gray-900);
            text-align: right;
        }

        .receipt-station-value {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 8px;
        }

        .receipt-station-logo {
            width: 24px;
            height: 24px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .receipt-station-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .receipt-total {
            background: linear-gradient(135deg, var(--dae-primary) 0%, var(--dae-teal) 100%);
            color: white;
            border-radius: 12px;
            padding: var(--space-lg);
            text-align: center;
            margin-top: var(--space-lg);
            box-shadow: var(--shadow-md);
        }

        .receipt-total-label {
            font-size: var(--font-size-sm);
            opacity: 0.9;
            margin-bottom: var(--space-xs);
        }

        .receipt-total-value {
            font-size: var(--font-size-3xl);
            font-weight: 700;
        }

        .receipt-actions {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .btn-secondary {
            flex: 1;
            padding: var(--space-md);
            background: white;
            color: var(--dae-primary);
            border: 2px solid var(--dae-primary);
            border-radius: 12px;
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .btn-secondary:active {
            background: var(--gray-50);
        }

        .btn-primary {
            flex: 1;
            padding: var(--space-md);
            background: var(--dae-primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .btn-primary:active {
            background: var(--dae-primary-dark);
        }

        /* ========== ANIMATIONS ========== */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========== UTILITIES ========== */
        .text-center {
            text-align: center;
        }

        .mb-lg {
            margin-bottom: var(--space-lg);
        }

        .mt-xl {
            margin-top: var(--space-xl);
        }

        /* ========== BOTTOM NAVIGATION - SYMMETRICAL REFINEMENT ========== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border-top: 0.5px solid var(--glass-border);
            display: flex;
            justify-content: space-around;
            padding: 8px 0 max(12px, env(safe-area-inset-bottom));
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 6px 0;
            cursor: pointer;
            border: none;
            background: transparent;
            transition: opacity 0.2s ease;
            min-height: 50px;
            position: relative;
        }

        .nav-item:active {
            opacity: 0.4;
        }

        .nav-item.active .nav-icon,
        .nav-item.active .nav-label {
            color: #007AFF;
        }

        .nav-icon {
            font-size: 20px;
            color: #8E8E93;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 10px;
            color: #8E8E93;
            font-weight: 500;
            letter-spacing: 0.01em;
        }

        /* Center Action - Balanced Focus */
        .nav-item.center-action .nav-icon {
            font-size: 24px;
            color: #007AFF;
        }

        .nav-badge {
            position: absolute;
            top: 4px;
            right: 25%;
            min-width: 18px;
            height: 18px;
            background: #FF3B30;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: white;
            border: 2px solid white;
        }

        /* Adjust screen padding for bottom nav */
        .screen {
            padding-bottom: 100px;
        }

        /* Adjust screen padding for bottom nav */
        .screen {
            padding-bottom: 80px;
        }

        /* ========== ACTIVITY (HISTORY) SCREEN ========== */
        .history-screen {
            background: #F2F2F7;
        }

        .screen-header {
            background: #000000;
            color: white;
            padding: var(--space-xl) var(--space-md) var(--space-lg);
            border-bottom-left-radius: var(--radius-xl);
            border-bottom-right-radius: var(--radius-xl);
        }

        .screen-header-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            letter-spacing: -0.03em;
        }

        .history-filters {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: var(--space-md);
            display: flex;
            gap: var(--space-sm);
            overflow-x: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
            background: #F2F2F7;
            border-bottom: 0.5px solid rgba(0, 0, 0, 0.1);
        }

        .history-filters::-webkit-scrollbar {
            display: none;
        }

        .filter-chip {
            padding: 8px 16px;
            background: white;
            border: 0.5px solid rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: #000000;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .filter-chip.active {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }

        .history-list {
            padding: 0 var(--space-md);
        }

        .history-item {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            border: 0.5px solid rgba(0, 0, 0, 0.05);
            transition: opacity 0.2s ease;
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }

        .history-item-station {
            font-weight: 700;
            font-size: var(--font-size-base);
            color: #000000;
            letter-spacing: -0.01em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-item-logo {
            width: 24px;
            height: 24px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .history-item-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .history-item-date {
            font-size: var(--font-size-xs);
            color: #8E8E93;
            font-weight: 500;
        }

        .history-item-amount {
            font-size: var(--font-size-xl);
            font-weight: 800;
            color: #000000;
            letter-spacing: -0.02em;
        }

        .history-item-details {
            display: flex;
            gap: var(--space-lg);
            padding-top: var(--space-sm);
            border-top: 0.5px solid rgba(0, 0, 0, 0.05);
        }

        .history-item-detail {
            flex: 1;
        }

        .history-item-detail-label {
            font-size: var(--font-size-xs);
            color: #8E8E93;
            margin-bottom: 2px;
        }

        .history-item-detail-value {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: #000000;
        }

        .empty-state {
            text-align: center;
            padding: var(--space-2xl) var(--space-md);
        }

        .empty-state-icon {
            font-size: 64px;
            color: #C7C7CC;
            margin-bottom: var(--space-lg);
        }

        .empty-state-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-sm);
        }

        .empty-state-message {
            font-size: var(--font-size-base);
            color: var(--gray-600);
            line-height: 1.6;
        }

        /* ========== SETTINGS (PROFILE) SCREEN REFINEMENT ========== */
        .settings-screen {
            background: #F2F2F7;
        }

        .settings-profile {
            background: #000000;
            padding: var(--space-xl) var(--space-md);
            text-align: center;
            border-bottom-left-radius: var(--radius-xl);
            border-bottom-right-radius: var(--radius-xl);
            margin-bottom: var(--space-lg);
        }

        .settings-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-md);
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .settings-avatar i {
            font-size: 40px;
            color: white;
        }

        .settings-name {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: white;
            letter-spacing: -0.02em;
        }

        .settings-role {
            font-size: var(--font-size-sm);
            color: rgba(255, 255, 255, 0.5);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .settings-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 0 var(--space-md);
            margin-bottom: var(--space-lg);
            border: 0.5px solid rgba(0, 0, 0, 0.05);
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md) 0;
            border-bottom: 0.5px solid rgba(0, 0, 0, 0.05);
        }

        border-bottom: 1px solid var(--gray-100);
        cursor: pointer;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item:active {
            background: var(--gray-50);
        }

        .settings-item-left {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .settings-item-left {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .settings-item-icon {
            width: 32px;
            height: 32px;
            background: #F2F2F7;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #007AFF;
            font-size: 14px;
        }

        .settings-item-label {
            font-size: var(--font-size-base);
            font-weight: 500;
            color: #000000;
        }

        .settings-item-value {
            font-size: var(--font-size-sm);
            color: #8E8E93;
        }

        .settings-item-arrow {
            color: #C7C7CC;
            font-size: 14px;
        }

        /* ========== MESSAGES (INBOX) SCREEN ========== */
        .inbox-screen {
            background: #F2F2F7;
        }

        .inbox-list {
            padding: 0 var(--space-md);
        }

        .inbox-item {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            border: 0.5px solid rgba(0, 0, 0, 0.05);
            transition: opacity 0.2s ease;
            position: relative;
        }

        .inbox-item.unread {
            background: rgba(0, 122, 255, 0.03);
        }

        .inbox-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 4px;
        }

        .inbox-item-title {
            font-weight: 700;
            font-size: var(--font-size-base);
            color: #000000;
            letter-spacing: -0.01em;
        }

        .inbox-item-time {
            font-size: var(--font-size-xs);
            color: #8E8E93;
            font-weight: 500;
        }

        .inbox-item-preview {
            font-size: var(--font-size-sm);
            color: #8E8E93;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .inbox-item-badge {
            position: absolute;
            top: 16px;
            right: -4px;
            width: 8px;
            height: 8px;
            background: #007AFF;
            border-radius: 50%;
        }

        .inbox-category-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: var(--space-sm);
        }

        .inbox-category-system {
            background: #F2F2F7;
            color: #8E8E93;
        }

        .inbox-category-promotion {
            background: rgba(255, 149, 0, 0.1);
            color: #FF9500;
        }

        .inbox-category-alert {
            background: #FEE2E2;
            color: #DC2626;
        }
    </style>
</head>

<body>
    <div class="mobile-container">
        <!-- The mock status bar has been removed to respect the native device environment -->

        <!-- SCREEN 1: Welcome / Splash -->
        <div id="screen-welcome" class="screen active welcome-screen">
            <svg class="welcome-logo" viewBox="0 0 300 300" fill="currentColor">
                <path d="M150 50L250 250H50L150 50Z" opacity="0.1" />
                <text x="50%" y="45%" font-size="90" font-weight="800" text-anchor="middle"
                    font-family="-apple-system">DAE</text>
                <text x="50%" y="65%" font-size="16" font-weight="500" text-anchor="middle" font-family="-apple-system"
                    opacity="0.6">DIGITAL ASSISTANT</text>
            </svg>
            <h1 class="welcome-title">Refined Excellence</h1>
            <p class="welcome-subtitle">A new era of energy management</p>
            <button class="btn-start" onclick="startApp()">Enter Experience</button>
        </div>

        <!-- SCREEN 2: Home with Map -->
        <div id="screen-home" class="screen home-screen">
            <header class="home-header">
                <div class="home-header-top">
                    <div class="home-driver-avatar">
                        <svg viewBox="0 0 100 100" width="52" height="52">
                            <circle cx="50" cy="50" r="48" fill="#8B5A2B"/>
                            <circle cx="50" cy="38" r="18" fill="#6B4423"/>
                            <ellipse cx="50" cy="75" rx="28" ry="22" fill="#1E40AF"/>
                            <circle cx="42" cy="35" r="2" fill="#1F2937"/>
                            <circle cx="58" cy="35" r="2" fill="#1F2937"/>
                            <path d="M44 44 Q50 48, 56 44" stroke="#1F2937" stroke-width="2" fill="none" stroke-linecap="round"/>
                            <path d="M32 25 Q50 15, 68 25 L65 30 Q50 22, 35 30 Z" fill="#1F2937"/>
                        </svg>
                    </div>
                    <div class="home-driver-info">
                        <div class="home-driver-name">Abdul Hamid</div>
                        <div class="home-greeting">Tiong Nam Group A</div>
                    </div>
                </div>
                <div class="home-vehicle-card">
                    <div class="vehicle-image">
                        <svg viewBox="0 0 120 60" width="100%" height="50">
                            <rect x="5" y="25" width="70" height="30" rx="3" fill="#1E40AF"/>
                            <rect x="60" y="15" width="35" height="40" rx="4" fill="#1E3A8A"/>
                            <rect x="65" y="20" width="25" height="18" rx="2" fill="#93C5FD"/>
                            <circle cx="25" cy="55" r="8" fill="#374151"/>
                            <circle cx="25" cy="55" r="4" fill="#6B7280"/>
                            <circle cx="75" cy="55" r="8" fill="#374151"/>
                            <circle cx="75" cy="55" r="4" fill="#6B7280"/>
                            <rect x="100" y="25" width="15" height="25" rx="2" fill="#9CA3AF"/>
                            <text x="60" y="10" font-size="6" fill="white" text-anchor="middle">Mercedes-Benz Actros</text>
                        </svg>
                    </div>
                    <div class="vehicle-details">
                        <span class="registration">ABC-1234</span>
                        <span class="vehicle-model">Mercedes-Benz Actros</span>
                    </div>
                </div>
            </header>

            <div class="home-content">
                <!-- Quick Stats -->
                <div class="quick-stats-card">
                    <div class="stat-row fuel-available">
                        <div class="stat-info">
                            <div class="stat-label">Available Today</div>
                            <div class="stat-value large">180L</div>
                        </div>
                        <div class="fuel-bar-container">
                            <div class="fuel-bar" style="width: 72%;"></div>
                        </div>
                        <div class="fuel-percentage">72%</div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-label">Daily Limit</div>
                        <div class="stat-value">250L</div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-label">Fuel Type</div>
                        <div class="stat-value fuel-type">
                            <i class="fas fa-gas-pump" style="color: #F59E0B; margin-right: 6px;"></i>
                            Diesel
                        </div>
                    </div>
                </div>

                <!-- Primary Action -->
                <div class="action-card" onclick="startFueling()">
                    <div class="action-icon">
                        <i class="fas fa-gas-pump"></i>
                    </div>
                    <div class="action-title">Start Fueling</div>
                    <div class="action-subtitle">Tap to begin your fueling journey</div>
                </div>

                <!-- Map Section -->
                <div class="map-section">
                    <div class="section-header">
                        <div class="section-title">Nearby Stations</div>
                        <a href="#" class="see-all-link" onclick="event.preventDefault(); viewAllStations();">See
                            All</a>
                    </div>

                    <div id="map"></div>

                    <div class="station-item" onclick="selectStation('Petros Batu Kawa')">
                        <div class="station-logo">
                            <img src="petros.svg.png" alt="Petros">
                        </div>
                        <div class="station-details">
                            <div class="station-name">Petros Batu Kawa</div>
                            <div class="station-distance">0.3 km away  Open 24/7</div>
                            <div class="station-amenities">
                                <div class="amenity-icon amenity-restaurant" title="Restaurant">
                                    <i class="fas fa-utensils"></i>
                                </div>
                                <div class="amenity-icon amenity-surau" title="Surau">
                                    <i class="fas fa-mosque"></i>
                                </div>
                                <div class="amenity-icon amenity-shower" title="Shower">
                                    <i class="fas fa-shower"></i>
                                </div>
                                <div class="amenity-icon amenity-atm" title="ATM">
                                    <i class="fas fa-money-bill"></i>
                                </div>
                                <div class="amenity-icon amenity-parking" title="Truck Parking">
                                    <i class="fas fa-truck"></i>
                                </div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right station-arrow"></i>
                    </div>

                    <div class="station-item" onclick="selectStation('Shell Petra Jaya')">
                        <div class="station-logo">
                            <img src="shell.png" alt="Shell">
                        </div>
                        <div class="station-details">
                            <div class="station-name">Shell Petra Jaya</div>
                            <div class="station-distance">1.5 km away  6am - 10pm</div>
                            <div class="station-amenities">
                                <div class="amenity-icon amenity-restaurant" title="Restaurant">
                                    <i class="fas fa-utensils"></i>
                                </div>
                                <div class="amenity-icon amenity-shower" title="Shower">
                                    <i class="fas fa-shower"></i>
                                </div>
                                <div class="amenity-icon amenity-atm" title="ATM">
                                    <i class="fas fa-money-bill"></i>
                                </div>
                                <div class="amenity-icon amenity-fuel" title="Diesel">
                                    <span style="font-weight: 700; font-size: 9px;">D</span>
                                </div>
                                <div class="amenity-icon amenity-parking" title="Truck Parking">
                                    <i class="fas fa-truck"></i>
                                </div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right station-arrow"></i>
                    </div>

                    <div class="station-item" onclick="selectStation('PETRONAS Green Height')">
                        <div class="station-logo">
                            <img src="petronas.png" alt="PETRONAS">
                        </div>
                        <div class="station-details">
                            <div class="station-name">PETRONAS Green Height</div>
                            <div class="station-distance">1.8 km away  Open 24/7</div>
                            <div class="station-amenities">
                                <div class="amenity-icon amenity-surau" title="Surau">
                                    <i class="fas fa-mosque"></i>
                                </div>
                                <div class="amenity-icon amenity-atm" title="ATM">
                                    <i class="fas fa-money-bill"></i>
                                </div>
                                <div class="amenity-icon amenity-fuel" title="Euro 5">
                                    <span style="font-weight: 700; font-size: 9px;">E5</span>
                                </div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right station-arrow"></i>
                    </div>

                    <div class="station-item" onclick="selectStation('Petron Jalan Tun Abang Hj Openg')">
                        <div class="station-logo">
                            <img src="petron.png" alt="Petron">
                        </div>
                        <div class="station-details">
                            <div class="station-name">Petron Jln Tun Abang Hj Openg</div>
                            <div class="station-distance">2.5 km away  Open 24/7</div>
                            <div class="station-amenities">
                                <div class="amenity-icon amenity-restaurant" title="Restaurant">
                                    <i class="fas fa-utensils"></i>
                                </div>
                                <div class="amenity-icon amenity-surau" title="Surau">
                                    <i class="fas fa-mosque"></i>
                                </div>
                                <div class="amenity-icon amenity-atm" title="ATM">
                                    <i class="fas fa-money-bill"></i>
                                </div>
                                <div class="amenity-icon amenity-fuel" title="Diesel">
                                    <span style="font-weight: 700; font-size: 9px;">D</span>
                                </div>
                                <div class="amenity-icon amenity-parking" title="Truck Parking">
                                    <i class="fas fa-truck"></i>
                                </div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right station-arrow"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCREEN 3: NFC Tap Instructions -->
        <div id="screen-nfc" class="screen nfc-screen">
            <div class="nfc-animation">
                <div class="nfc-pulse"></div>
                <div class="nfc-pulse"></div>
                <div class="nfc-pulse"></div>
                <div class="nfc-icon">
                    <i class="fas fa-broadcast-tower"></i>
                </div>
            </div>

            <h2 class="nfc-title">Tap Your Phone</h2>
            <p class="nfc-instruction">Hold your phone near the NFC sticker on your vehicle's windshield</p>

            <div class="nfc-illustration">
                <svg width="100%" height="220" viewBox="0 0 320 220">
                    <defs>
                        <style>
                            @keyframes phoneMove {
                                0%, 15% { transform: translateX(0); }
                                45%, 55% { transform: translateX(-85px); }
                                85%, 100% { transform: translateX(0); }
                            }
                            @keyframes nfcPulse {
                                0%, 40% { opacity: 0.3; transform: scale(1); }
                                45%, 55% { opacity: 1; transform: scale(1.2); }
                                60%, 100% { opacity: 0.3; transform: scale(1); }
                            }
                            .phone-anim { animation: phoneMove 3.5s ease-in-out infinite; }
                            .nfc-pulse { animation: nfcPulse 3.5s ease-in-out infinite; transform-origin: center; }
                        </style>
                        <linearGradient id="cabGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#1E40AF"/>
                            <stop offset="100%" style="stop-color:#1E3A8A"/>
                        </linearGradient>
                        <linearGradient id="glassGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#DBEAFE"/>
                            <stop offset="100%" style="stop-color:#93C5FD"/>
                        </linearGradient>
                    </defs>

                    <!-- Truck cab body -->
                    <rect x="15" y="70" width="180" height="130" rx="8" fill="url(#cabGrad)"/>

                    <!-- Windshield (large, angled) -->
                    <path d="M 25 75 L 185 75 L 170 145 L 40 145 Z" fill="url(#glassGrad)" stroke="#60A5FA" stroke-width="3"/>

                    <!-- Windshield reflection -->
                    <path d="M 40 82 L 85 82 L 78 100 L 47 100 Z" fill="rgba(255,255,255,0.4)"/>

                    <!-- NFC Sticker on windshield -->
                    <g class="nfc-pulse">
                        <circle cx="145" cy="115" r="28" fill="#3B82F6" opacity="0.3"/>
                    </g>
                    <circle cx="145" cy="115" r="22" fill="#3B82F6"/>
                    <text x="145" y="112" font-size="8" fill="white" text-anchor="middle" font-weight="bold">NFC</text>
                    <text x="145" y="122" font-size="6" fill="rgba(255,255,255,0.8)" text-anchor="middle">TAP HERE</text>

                    <!-- Side mirror -->
                    <rect x="0" y="100" width="22" height="16" rx="3" fill="#374151"/>
                    <rect x="3" y="103" width="16" height="10" rx="2" fill="#9CA3AF"/>

                    <!-- Truck grille area -->
                    <rect x="40" y="150" width="130" height="45" rx="4" fill="#1E3A8A"/>
                    <rect x="55" y="158" width="100" height="12" rx="2" fill="#374151"/>

                    <!-- Headlights -->
                    <ellipse cx="55" cy="180" rx="12" ry="10" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1"/>
                    <ellipse cx="155" cy="180" rx="12" ry="10" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1"/>

                    <!-- Phone (animated) -->
                    <g class="phone-anim">
                        <rect x="250" y="65" width="55" height="95" rx="8" fill="#1F2937"/>
                        <rect x="254" y="75" width="47" height="75" rx="3" fill="#F3F4F6"/>
                        <circle cx="277" cy="70" r="2" fill="#4B5563"/>
                        <rect x="267" y="155" width="20" height="3" rx="1" fill="#4B5563"/>
                        <!-- Phone screen -->
                        <rect x="262" y="95" width="30" height="30" rx="4" fill="#3B82F6"/>
                        <text x="277" y="114" font-size="9" fill="white" text-anchor="middle" font-weight="bold">DAE</text>
                        <text x="277" y="138" font-size="6" fill="#6B7280" text-anchor="middle">Ready to scan</text>
                    </g>

                    <!-- Label -->
                    <text x="105" y="210" font-size="11" fill="#6B7280" text-anchor="middle" font-weight="500">Hold phone near NFC sticker on windshield</text>
                </svg>
            </div>

            <div class="nfc-tip">
                <div class="nfc-tip-title">
                    <i class="fas fa-lightbulb"></i>
                    Tip
                </div>
                <div class="nfc-tip-text">
                    The NFC sticker is located on the driver's side of the windshield, clearly visible and easy to
                    reach.
                </div>
            </div>

            <button class="btn-proceed" onclick="simulateNFCTap()" style="margin-top: 24px;">
                <i class="fas fa-hand-pointer"></i> Simulate NFC Tap
            </button>

            <button class="btn-cancel" onclick="goToHome()">Cancel</button>
        </div>

        <!-- SCREEN 4: Loading / Processing -->
        <div id="screen-loading" class="screen loading-screen">
            <div class="loading-fleet-graphic">
                <svg viewBox="0 0 280 140" width="280" height="140">
                    <defs>
                        <linearGradient id="truckGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#3B82F6"/>
                            <stop offset="100%" style="stop-color:#1E40AF"/>
                        </linearGradient>
                    </defs>

                    <!-- Truck 1 (main, foreground) -->
                    <g>
                        <!-- Trailer -->
                        <rect x="20" y="55" width="120" height="60" rx="4" fill="url(#truckGradient)"/>
                        <rect x="25" y="60" width="110" height="50" rx="2" fill="#1E3A8A" opacity="0.3"/>
                        <text x="80" y="90" font-size="12" fill="white" text-anchor="middle" font-weight="bold" opacity="0.8">DAE FLEET</text>

                        <!-- Cab -->
                        <rect x="140" y="45" width="50" height="70" rx="6" fill="url(#truckGradient)"/>
                        <rect x="148" y="52" width="35" height="28" rx="3" fill="#BFDBFE"/>
                        <rect x="148" y="52" width="35" height="8" fill="#93C5FD" rx="3"/>

                        <!-- Wheels -->
                        <circle cx="55" cy="118" r="12" fill="#1F2937"/>
                        <circle cx="55" cy="118" r="6" fill="#4B5563"/>
                        <circle cx="110" cy="118" r="12" fill="#1F2937"/>
                        <circle cx="110" cy="118" r="6" fill="#4B5563"/>
                        <circle cx="165" cy="118" r="12" fill="#1F2937"/>
                        <circle cx="165" cy="118" r="6" fill="#4B5563"/>

                        <!-- Headlight -->
                        <rect x="185" y="75" width="8" height="15" rx="2" fill="#FEF3C7"/>
                    </g>

                    <!-- Truck 2 (background, smaller) -->
                    <g opacity="0.4" transform="translate(180, 20) scale(0.5)">
                        <rect x="20" y="55" width="100" height="50" rx="3" fill="#64748B"/>
                        <rect x="120" y="48" width="40" height="57" rx="4" fill="#64748B"/>
                        <circle cx="50" cy="108" r="8" fill="#374151"/>
                        <circle cx="90" cy="108" r="8" fill="#374151"/>
                        <circle cx="140" cy="108" r="8" fill="#374151"/>
                    </g>

                    <!-- Ground line -->
                    <line x1="0" y1="130" x2="280" y2="130" stroke="#E5E7EB" stroke-width="2"/>
                </svg>
            </div>
            <div class="loading-spinner"></div>
            <h3 class="loading-title">Processing...</h3>
            <p class="loading-message">Validating your transaction</p>
            <p class="motivational-message" id="motivationalText">"Safety first, efficiency always"</p>
        </div>

        <!-- SCREEN 5: QR Code Display -->
        <div id="screen-qr" class="screen qr-screen">
            <div class="qr-header">
                <div class="qr-status">
                    <i class="fas fa-clock"></i>
                    <span>Valid for <span id="qrTimer">5:00</span> minutes</span>
                </div>
                <h2 class="qr-title">Show QR to Cashier</h2>
                <p class="qr-subtitle">Present this code at the station counter</p>
            </div>

            <div class="qr-code-container">
                <div class="qr-code" id="qrCodeDisplay">
                    <!-- QR Code will be generated here -->
                </div>
                <div class="qr-txn-id">TXN-<span id="txnId">12345</span></div>
            </div>

            <div class="qr-details">
                <div class="qr-detail-row">
                    <span class="qr-detail-label">Max Amount</span>
                    <span class="qr-detail-value">250L</span>
                </div>
                <div class="qr-detail-row">
                    <span class="qr-detail-label">Fuel Type</span>
                    <span class="qr-detail-value">Diesel</span>
                </div>
                <div class="qr-detail-row">
                    <span class="qr-detail-label">Vehicle</span>
                    <span class="qr-detail-value">ABC-1234</span>
                </div>
            </div>

            <div class="qr-instruction-box">
                <h3>Next Steps</h3>
                <p>The cashier will scan this code to authorize your fueling. Please wait for confirmation before
                    proceeding to the pump.</p>
            </div>

            <button class="btn-cancel" onclick="cancelTransaction()">Cancel Transaction</button>
        </div>

        <!-- SCREEN 6: Approval -->
        <div id="screen-approval" class="screen approval-screen">
            <div class="approval-icon">
                <i class="fas fa-check"></i>
            </div>

            <h2 class="approval-title">Approved!</h2>
            <p class="approval-message">You are authorized to proceed with fueling</p>

            <div class="approval-card">
                <div class="approval-detail">
                    <span class="approval-label">Approved Amount</span>
                    <span class="approval-value">250L</span>
                </div>
                <div class="approval-detail">
                    <span class="approval-label">Fuel Type</span>
                    <span class="approval-value">Diesel</span>
                </div>
                <div class="approval-detail">
                    <span class="approval-label">Pump Number</span>
                    <span class="approval-value">Pump 3</span>
                </div>
            </div>

            <button class="btn-proceed" onclick="simulateFueling()">Proceed to Pump</button>
        </div>

        <!-- SCREEN 7: E-Receipt -->
        <div id="screen-receipt" class="screen receipt-screen">
            <div class="receipt-header">
                <div class="receipt-icon">
                    <i class="fas fa-receipt"></i>
                </div>
                <h2 class="receipt-title">Transaction Complete</h2>
                <p class="receipt-subtitle">Thank you for using DAE</p>
            </div>

            <div class="receipt-card">
                <!-- Transaction Details -->
                <div class="receipt-section">
                    <div class="receipt-section-title">Transaction Details</div>
                    <div class="receipt-row">
                        <span class="receipt-label">Receipt No.</span>
                        <span class="receipt-value" id="receiptNo">RCP-20260115-001</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Transaction ID</span>
                        <span class="receipt-value" id="receiptTxnId">TXN-12345</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Date & Time</span>
                        <span class="receipt-value" id="receiptDateTime">15 Jan 2026, 14:32</span>
                    </div>
                </div>

                <!-- Driver & Vehicle -->
                <div class="receipt-section">
                    <div class="receipt-section-title">Driver & Vehicle</div>
                    <div class="receipt-row">
                        <span class="receipt-label">Driver Name</span>
                        <span class="receipt-value">Abdul Hamid</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Phone Number</span>
                        <span class="receipt-value">+60 12-345 6789</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Vehicle</span>
                        <span class="receipt-value">ABC-1234</span>
                    </div>
                </div>

                <!-- Station Details -->
                <div class="receipt-section">
                    <div class="receipt-section-title">Station Information</div>
                    <div class="receipt-row">
                        <span class="receipt-label">Station Name</span>
                        <span class="receipt-value receipt-station-value">
                            <span class="receipt-station-logo"><img src="petros.svg.png" alt="" id="receiptStationLogo"></span>
                            <span id="receiptStationName">Petros Batu Kawa</span>
                        </span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Station ID</span>
                        <span class="receipt-value">STN-BK-001</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Address</span>
                        <span class="receipt-value">Jalan Batu Kawa, Kuching</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Contact</span>
                        <span class="receipt-value">+60 82-123 456</span>
                    </div>
                </div>

                <!-- Fuel Details -->
                <div class="receipt-section">
                    <div class="receipt-section-title">Fuel Details</div>
                    <div class="receipt-row">
                        <span class="receipt-label">Product</span>
                        <span class="receipt-value">Diesel</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Volume</span>
                        <span class="receipt-value" id="receiptVolume">45.2L</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Price per Liter</span>
                        <span class="receipt-value">MYR 3.50</span>
                    </div>
                </div>

                <!-- Total -->
                <div class="receipt-total">
                    <div class="receipt-total-label">Total Amount</div>
                    <div class="receipt-total-value">MYR <span id="receiptTotal">158.20</span></div>
                </div>
            </div>

            <div class="receipt-actions">
                <button class="btn-secondary" onclick="downloadReceipt()">
                    <i class="fas fa-download"></i> Download
                </button>
                <button class="btn-primary" onclick="goToHome()">
                    <i class="fas fa-home"></i> Back to Home
                </button>
            </div>
        </div>

        <!-- SCREEN 8: History -->
        <div id="screen-history" class="screen history-screen">
            <div class="screen-header">
                <h2 class="screen-header-title">Transaction History</h2>
                <p class="screen-header-subtitle">View your past fueling transactions</p>
            </div>

            <div class="history-filters">
                <button class="filter-chip active" onclick="filterHistory('all')">All</button>
                <button class="filter-chip" onclick="filterHistory('today')">Today</button>
                <button class="filter-chip" onclick="filterHistory('week')">This Week</button>
                <button class="filter-chip" onclick="filterHistory('month')">This Month</button>
            </div>

            <div class="history-list" id="historyList">
                <!-- History items will be populated here -->
            </div>
        </div>

        <!-- SCREEN 9: Settings -->
        <div id="screen-settings" class="screen settings-screen">
            <div class="settings-profile">
                <div class="settings-avatar" onclick="changeProfilePicture()">
                    <i class="fas fa-user"></i>
                    <div class="settings-avatar-edit">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
                <div class="settings-name">Abdul Hamid</div>
                <div class="settings-role">Professional Truck Driver</div>
            </div>

            <div class="settings-sections">
                <!-- Driver Information -->
                <div class="settings-section">
                    <div class="settings-section-title">Driver Information</div>

                    <div class="settings-item" onclick="editDriverInfo('name')">
                        <div class="settings-item-left">
                            <div class="settings-item-icon">
                                <i class="fas fa-id-card"></i>
                            </div>
                            <div class="settings-item-text">
                                <div class="settings-item-label">Full Name</div>
                                <div class="settings-item-value">Abdul Hamid</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right settings-item-arrow"></i>
                    </div>

                    <div class="settings-item" onclick="editDriverInfo('phone')">
                        <div class="settings-item-left">
                            <div class="settings-item-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="settings-item-text">
                                <div class="settings-item-label">Phone Number</div>
                                <div class="settings-item-value">+60 12-345 6789</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right settings-item-arrow"></i>
                    </div>

                    <div class="settings-item" onclick="editDriverInfo('license')">
                        <div class="settings-item-left">
                            <div class="settings-item-icon">
                                <i class="fas fa-id-badge"></i>
                            </div>
                            <div class="settings-item-text">
                                <div class="settings-item-label">License Number</div>
                                <div class="settings-item-value">DRV-001-2024</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right settings-item-arrow"></i>
                    </div>
                </div>

                <!-- Vehicle Information -->
                <div class="settings-section">
                    <div class="settings-section-title">Authorized Vehicles</div>

                    <div class="settings-item" onclick="selectVehicle('ABC-1234')">
                        <div class="settings-item-left">
                            <div class="settings-item-icon">
                                <i class="fas fa-truck"></i>
                            </div>
                            <div class="settings-item-text">
                                <div class="settings-item-label">Mercedes-Benz Actros</div>
                                <div class="settings-item-value">ABC-1234  Diesel  250L/day</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right settings-item-arrow"></i>
                    </div>

                    <div class="settings-item" onclick="selectVehicle('QK888')">
                        <div class="settings-item-left">
                            <div class="settings-item-icon" style="background: #FEF3C7; color: #D97706;">
                                <i class="fas fa-truck"></i>
                            </div>
                            <div class="settings-item-text">
                                <div class="settings-item-label">Hino 700 Series</div>
                                <div class="settings-item-value">QK888  Diesel  250L/day</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right settings-item-arrow"></i>
                    </div>
                </div>

                <!-- App Settings -->
                <div class="settings-section">
                    <div class="settings-section-title">App Settings</div>

                    <div class="settings-item" onclick="changeSetting('language')">
                        <div class="settings-item-left">
                            <div class="settings-item-icon">
                                <i class="fas fa-language"></i>
                            </div>
                            <div class="settings-item-text">
                                <div class="settings-item-label">Language</div>
                                <div class="settings-item-value">English</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right settings-item-arrow"></i>
                    </div>

                    <div class="settings-item" onclick="changeSetting('notifications')">
                        <div class="settings-item-left">
                            <div class="settings-item-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="settings-item-text">
                                <div class="settings-item-label">Notifications</div>
                                <div class="settings-item-value">Enabled</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right settings-item-arrow"></i>
                    </div>
                </div>

                <!-- Support & Legal -->
                <div class="settings-section">
                    <div class="settings-section-title">Support & Legal</div>

                    <div class="settings-item" onclick="openHelp()">
                        <div class="settings-item-left">
                            <div class="settings-item-icon">
                                <i class="fas fa-circle-question"></i>
                            </div>
                            <div class="settings-item-text">
                                <div class="settings-item-label">Help & Support</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right settings-item-arrow"></i>
                    </div>

                    <div class="settings-item" onclick="openAbout()">
                        <div class="settings-item-left">
                            <div class="settings-item-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="settings-item-text">
                                <div class="settings-item-label">About DAE</div>
                                <div class="settings-item-value">Version 1.0.0 (POC)</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right settings-item-arrow"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCREEN 10: Inbox -->
        <div id="screen-inbox" class="screen inbox-screen">
            <header class="screen-header">
                <h1 class="screen-header-title">Messages</h1>
            </header>

            <div class="inbox-list" id="inboxList">
                <!-- Messages will be populated here -->
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item" onclick="startFueling()" id="nav-fuel">
                <i class="fas fa-gas-pump nav-icon"></i>
                <span class="nav-label">Energy</span>
            </button>

            <button class="nav-item" onclick="goToHistory()" id="nav-history">
                <i class="fas fa-clock-rotate-left nav-icon"></i>
                <span class="nav-label">History</span>
            </button>

            <button class="nav-item center-action" onclick="goToHome()" id="nav-home">
                <i class="fas fa-house-chimney nav-icon"></i>
                <span class="nav-label">Home</span>
            </button>

            <button class="nav-item" onclick="goToInbox()" id="nav-inbox">
                <i class="fas fa-envelope nav-icon"></i>
                <span class="nav-label">Messages</span>
                <div class="nav-badge" id="inbox-badge">2</div>
            </button>

            <button class="nav-item" onclick="goToSettings()" id="nav-settings">
                <i class="fas fa-user-circle nav-icon"></i>
                <span class="nav-label">Profile</span>
            </button>
        </nav>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
        // ========== STATION LOGO HELPER ==========
        function getStationLogo(stationName) {
            const name = stationName.toLowerCase();
            if (name.includes('petronas')) return 'petronas.png';
            if (name.includes('shell')) return 'shell.png';
            if (name.includes('petron')) return 'petron.png';
            if (name.includes('petros')) return 'petros.svg.png';
            return null;
        }

        // ========== GLOBAL MOTION & STATE ==========
        const Motion = {
            spring: "cubic-bezier(0.17, 0.67, 0.43, 1.1)",
            smooth: "cubic-bezier(0.4, 0, 0.2, 1)",

            transition: function (fromId, toId) {
                const from = document.getElementById(fromId);
                const to = document.getElementById(toId);

                if (!from || !to) return;

                from.style.transition = `opacity 0.4s ${this.smooth}, transform 0.4s ${this.spring}`;
                to.style.transition = `opacity 0.4s ${this.smooth}, transform 0.4s ${this.spring}`;

                from.style.opacity = '0';
                from.style.transform = 'scale(0.98)';

                setTimeout(() => {
                    from.classList.remove('active');
                    to.classList.add('active');
                    to.style.transform = 'scale(1.02)';
                    to.style.opacity = '0';

                    requestAnimationFrame(() => {
                        to.style.transform = 'scale(1)';
                        to.style.opacity = '1';
                    });
                }, 400);
            }
        };

        let currentScreenId = 'screen-welcome';
        let transactionHistory = [];
        let inboxMessages = [];
        let map = null;
        let qrTimerInterval = null;
        let transactionData = null;

        // Motivational messages for loading screen
        const motivationalMessages = [
            "Safety first, efficiency always",
            "Drive smart, fuel smart",
            "Every journey begins with a single step",
            "Your time matters, we make it count",
            "Excellence in every mile",
            "Powering your journey forward"
        ];

        // Generate sample inbox messages
        function generateSampleInbox() {
            const now = new Date();
            inboxMessages = [
                {
                    id: 1,
                    title: 'Welcome to DAE!',
                    preview: 'Thank you for joining the Digital Assistant for Energy platform. Get started by completing your first fueling transaction.',
                    time: '2 days ago',
                    unread: true,
                    category: 'system',
                    fullMessage: 'Welcome to DAE - Digital Assistant for Energy!\n\nWe are excited to have you on board. This platform will help you manage your fuel transactions efficiently and safely.\n\nTo get started:\n1. Ensure your vehicle information is up to date\n2. Check nearby fuel stations on the home screen\n3. Tap "Start Fueling" when you\'re ready\n\nIf you need assistance, visit the Help & Support section in Settings.'
                },
                {
                    id: 2,
                    title: 'Special Promotion: 5% Off Diesel',
                    preview: 'Get 5% discount on all diesel purchases at PETRONAS stations this week! Valid until Sunday.',
                    time: '1 day ago',
                    unread: true,
                    category: 'promotion',
                    fullMessage: 'Limited Time Offer!\n\nEnjoy 5% off all diesel purchases at participating PETRONAS stations.\n\nPromotion Period: 13 Jan - 19 Jan 2026\n\nTerms & Conditions:\n- Valid for all diesel grades\n- Maximum discount: MYR 50 per transaction\n- Cannot be combined with other promotions\n\nHappy fueling!'
                },
                {
                    id: 3,
                    title: 'System Maintenance Notice',
                    preview: 'Scheduled maintenance on 20 Jan 2026 from 2:00 AM to 4:00 AM. Service may be temporarily unavailable.',
                    time: '3 hours ago',
                    unread: false,
                    category: 'alert',
                    fullMessage: 'Scheduled System Maintenance\n\nDate: 20 January 2026\nTime: 2:00 AM - 4:00 AM (MYT)\n\nDuring this period:\n- Mobile app may be temporarily unavailable\n- Transaction history may not update in real-time\n- QR code generation may experience delays\n\nWe apologize for any inconvenience. Emergency fuel transactions can still be processed manually at station counters.\n\nThank you for your understanding.'
                },
                {
                    id: 4,
                    title: 'New Station Added: Shell Tabuan',
                    preview: 'Great news! A new participating station has been added to your area. Check it out on the map.',
                    time: 'Yesterday',
                    unread: false,
                    category: 'system',
                    fullMessage: 'New Station Available\n\nShell Tabuan is now part of the DAE network!\n\nLocation: Jalan Tabuan, Kuching\nDistance: 4.2 km from your location\n\nAmenities:\n- 24/7 Operation\n- Truck Parking Available\n- Surau (Prayer Room)\n- ATM\n- Convenience Store\n\nOpen the app to view on map and start fueling there today!'
                },
                {
                    id: 5,
                    title: 'Monthly Usage Report Available',
                    preview: 'Your December 2025 fuel consumption report is ready for review. Download it from the History section.',
                    time: '5 days ago',
                    unread: false,
                    category: 'system',
                    fullMessage: 'December 2025 Usage Report\n\nYour monthly fuel consumption report is now available.\n\nSummary:\n- Total Transactions: 24\n- Total Volume: 1,245L\n- Total Amount: MYR 4,357.50\n- Most Visited Station: Petros Batu Kawa\n\nTo download the detailed report, visit the History tab and tap "Download Monthly Report".\n\nThank you for using DAE!'
                }
            ];
        }

        // Render inbox messages
        function renderInbox() {
            const inboxList = document.getElementById('inboxList');

            if (inboxMessages.length === 0) {
                inboxList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <h3 class="empty-state-title">No Messages</h3>
                        <p class="empty-state-message">You're all caught up! New messages will appear here.</p>
                    </div>
                `;
                return;
            }

            inboxList.innerHTML = inboxMessages.map(msg => `
                <div class="inbox-item ${msg.unread ? 'unread' : ''}" onclick="viewMessage(${msg.id})">
                    ${msg.unread ? '<div class="inbox-item-badge"></div>' : ''}
                    <div class="inbox-item-header">
                        <div>
                            <div class="inbox-item-title">${msg.title}</div>
                        </div>
                        <div class="inbox-item-time">${msg.time}</div>
                    </div>
                    <div class="inbox-item-preview">${msg.preview}</div>
                    <span class="inbox-category-badge inbox-category-${msg.category}">
                        ${msg.category.charAt(0).toUpperCase() + msg.category.slice(1)}
                    </span>
                </div>
            `).join('');

            // Update badge
            updateInboxBadge();
        }

        function viewMessage(messageId) {
            const message = inboxMessages.find(m => m.id === messageId);
            if (!message) return;

            // Mark as read
            message.unread = false;

            alert(`${message.title}\n\n${message.fullMessage}`);

            // Re-render inbox and update badge
            renderInbox();
        }

        // Generate sample transaction history
        function generateSampleHistory() {
            const stations = [
                'Petros Batu Kawa',
                'Shell Petra Jaya',
                'PETRONAS Green Height',
                'Petron Jln Tun Abang Hj Openg'
            ];

            const now = new Date();
            transactionHistory = [];

            for (let i = 0; i < 8; i++) {
                const date = new Date(now - (i * 86400000 * Math.random() * 5));
                const volume = (Math.random() * 50 + 20).toFixed(1);
                const pricePerLiter = 3.50;
                const total = (volume * pricePerLiter).toFixed(2);

                transactionHistory.push({
                    id: `TXN-${10000 + i}`,
                    receiptNo: `RCP-${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}-${i}`,
                    station: stations[Math.floor(Math.random() * stations.length)],
                    date: date,
                    dateString: `${date.getDate()} ${date.toLocaleString('en-US', { month: 'short' })} ${date.getFullYear()}`,
                    timeString: `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`,
                    volume: volume,
                    amount: total,
                    fuelType: 'Diesel',
                    vehicle: 'ABC-1234'
                });
            }
        }

        // Render history list
        function renderHistory(filter = 'all') {
            const historyList = document.getElementById('historyList');

            if (transactionHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <h3 class="empty-state-title">No Transactions Yet</h3>
                        <p class="empty-state-message">Your fueling history will appear here after your first transaction.</p>
                    </div>
                `;
                return;
            }

            // Filter transactions
            let filtered = transactionHistory;
            const now = new Date();

            if (filter === 'today') {
                filtered = transactionHistory.filter(t =>
                    t.date.toDateString() === now.toDateString()
                );
            } else if (filter === 'week') {
                const weekAgo = new Date(now - 7 * 86400000);
                filtered = transactionHistory.filter(t => t.date >= weekAgo);
            } else if (filter === 'month') {
                const monthAgo = new Date(now - 30 * 86400000);
                filtered = transactionHistory.filter(t => t.date >= monthAgo);
            }

            if (filtered.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-filter"></i>
                        </div>
                        <h3 class="empty-state-title">No Results</h3>
                        <p class="empty-state-message">No transactions found for this time period.</p>
                    </div>
                `;
                return;
            }

            historyList.innerHTML = filtered.map(txn => {
                const logo = getStationLogo(txn.station);
                const logoHtml = logo ? `<div class="history-item-logo"><img src="${logo}" alt=""></div>` : '';
                return `
                <div class="history-item" onclick="viewReceiptDetails('${txn.id}')">
                    <div class="history-item-header">
                        <div>
                            <div class="history-item-station">${logoHtml}<span>${txn.station}</span></div>
                            <div class="history-item-date">${txn.dateString}  ${txn.timeString}</div>
                        </div>
                        <div class="history-item-amount">MYR ${txn.amount}</div>
                    </div>
                    <div class="history-item-details">
                        <div class="history-item-detail">
                            <div class="history-item-detail-label">Volume</div>
                            <div class="history-item-detail-value">${txn.volume}L</div>
                        </div>
                        <div class="history-item-detail">
                            <div class="history-item-detail-label">Vehicle</div>
                            <div class="history-item-detail-value">${txn.vehicle}</div>
                        </div>
                        <div class="history-item-detail">
                            <div class="history-item-detail-label">Fuel Type</div>
                            <div class="history-item-detail-value">${txn.fuelType}</div>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        // ========== UTILITY FUNCTIONS ==========
        function navigateTo(screenId) {
            if (currentScreenId === screenId) return;

            const from = currentScreenId;
            const to = screenId;

            // Motion transition
            Motion.transition(from, to);
            currentScreenId = to;

            // Update Navigation active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const navMap = {
                'screen-home': 'nav-home',
                'screen-history': 'nav-history',
                'screen-inbox': 'nav-inbox',
                'screen-settings': 'nav-settings'
            };

            const activeNavId = navMap[screenId];
            if (activeNavId) {
                document.getElementById(activeNavId).classList.add('active');
            }

            // Special handling - initialize map after screen transition completes
            if (screenId === 'screen-home') {
                setTimeout(() => {
                    if (!map) {
                        initializeMap();
                    } else {
                        map.invalidateSize();
                    }
                }, 500);
            }
        }

        // Manual NFC tap simulation (triggered by button)
        function simulateNFCTap() {
            nfcTapped();
        }

        // ========== NAVIGATION FUNCTIONS ==========
        function goToHome() { navigateTo('screen-home'); }
        function startFueling() { navigateTo('screen-nfc'); }
        function goToHistory() { navigateTo('screen-history'); }
        function goToSettings() { navigateTo('screen-settings'); }
        function goToInbox() { navigateTo('screen-inbox'); }

        function selectVehicle(plateNumber) {
            const vehicles = {
                'ABC-1234': {
                    model: 'Mercedes-Benz Actros',
                    plate: 'ABC-1234',
                    fuel: 'Diesel',
                    limit: '250L/day'
                },
                'QK888': {
                    model: 'Hino 700 Series',
                    plate: 'QK888',
                    fuel: 'Diesel',
                    limit: '250L/day'
                }
            };

            const vehicle = vehicles[plateNumber];
            if (!vehicle) return;

            alert(`Vehicle Selected\n\n${vehicle.model}\nPlate: ${vehicle.plate}\nFuel Type: ${vehicle.fuel}\nDaily Limit: ${vehicle.limit}\n\nIn production, this would:\n- Switch active vehicle for fueling\n- Update home screen display\n- Adjust fuel limits accordingly`);
        }

        function updateInboxBadge() {
            const unreadCount = inboxMessages.filter(m => m.unread).length;
            const badge = document.getElementById('inbox-badge');
            if (badge) {
                if (unreadCount > 0) {
                    badge.textContent = unreadCount;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        function selectStation(stationName) {
            alert(`Station selected: ${stationName}\n\nIn production, this would:\n- Show detailed station information\n- Display directions in map\n- Show available fuel types and prices\n- Allow navigation to this station`);
        }

        function viewAllStations() {
            alert('View All Stations functionality would be implemented here.\n\nIn production, this would:\n- Show a full-screen map with all nearby stations\n- Allow filtering by fuel type, distance, price\n- Show real-time availability\n- Provide turn-by-turn navigation');
        }

        function filterHistory(filter) {
            // Update active filter chip
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.target.classList.add('active');

            renderHistory(filter);
        }

        function viewReceiptDetails(txnId) {
            const transaction = transactionHistory.find(t => t.id === txnId);
            if (!transaction) return;

            // Populate receipt screen with transaction data
            document.getElementById('receiptNo').textContent = transaction.receiptNo;
            document.getElementById('receiptTxnId').textContent = transaction.id;
            document.getElementById('receiptDateTime').textContent = `${transaction.dateString}, ${transaction.timeString}`;
            document.getElementById('receiptVolume').textContent = `${transaction.volume}L`;
            document.getElementById('receiptTotal').textContent = transaction.amount;

            // Update station name and logo
            document.getElementById('receiptStationName').textContent = transaction.station;
            const logo = getStationLogo(transaction.station);
            if (logo) {
                document.getElementById('receiptStationLogo').src = logo;
            }

            navigateTo('screen-receipt');
        }

        // ========== SETTINGS FUNCTIONS ==========
        function changeProfilePicture() {
            alert('Profile picture change functionality would be implemented here.\n\nIn production, this would open the device camera or photo gallery.');
        }

        function editDriverInfo(field) {
            const fieldNames = {
                name: 'Full Name',
                phone: 'Phone Number',
                license: 'License Number'
            };
            alert(`Edit ${fieldNames[field]} functionality would be implemented here.\n\nIn production, this would open an edit form.`);
        }

        function editVehicleInfo(field) {
            const fieldNames = {
                model: 'Vehicle Model',
                plate: 'License Plate',
                fuel: 'Fuel Type',
                limit: 'Daily Fuel Limit'
            };
            alert(`Edit ${fieldNames[field]} functionality would be implemented here.\n\nIn production, this would open an edit form.`);
        }

        function changeSetting(setting) {
            const settingNames = {
                language: 'Language',
                notifications: 'Notifications'
            };
            alert(`Change ${settingNames[setting]} functionality would be implemented here.\n\nIn production, this would open a settings modal.`);
        }

        function openHelp() {
            alert('Help & Support functionality would be implemented here.\n\nIn production, this would open:\n- FAQ section\n- Contact support\n- Tutorial videos\n- Live chat');
        }

        function openAbout() {
            alert('DAE - Digital Assistant for Energy\n\nVersion 1.0.0 (POC)\nBuild Date: January 2026\n\nDeveloped for Meta Sdn. Bhd.\n\n 2026 DAE. All rights reserved.');
        }

        // ========== APP FLOW FUNCTIONS ==========
        function startApp() {
            navigateTo('screen-home');

            // Populate sample data
            generateSampleHistory();
            generateSampleInbox();
            renderHistory('all');
            renderInbox();
        }

        function initializeMap() {
            if (map) return; // Already initialized

            try {
                // Driver location - near Petros Batu Kawa station
                const driverLocation = [1.5175, 110.3140];
                // Petros Batu Kawa station
                const petrosBatuKawa = [1.5155829493339648, 110.31229205902129];

                map = L.map('map', {
                    zoomControl: false,
                    scrollWheelZoom: false,
                    dragging: true,
                    attributionControl: false
                }).setView(driverLocation, 14);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 18
                }).addTo(map);

                // Add markers for gas stations near Batu Kawa
                const stations = [
                    { lat: 1.5155829493339648, lng: 110.31229205902129, name: 'Petros Batu Kawa', distance: '0.3 km' },
                    { lat: 1.5280, lng: 110.3250, name: 'Shell Petra Jaya', distance: '1.5 km' },
                    { lat: 1.5050, lng: 110.3000, name: 'PETRONAS Green Height', distance: '1.8 km' },
                    { lat: 1.5350, lng: 110.3350, name: 'Petron Jln Tun Abang Hj Openg', distance: '2.5 km' }
                ];

                // Custom marker icon
                const customIcon = L.divIcon({
                    className: 'custom-marker',
                    html: '<div style="background: #3B82F6; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"><i class="fas fa-gas-pump"></i></div>',
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });

                stations.forEach(station => {
                    L.marker([station.lat, station.lng], { icon: customIcon })
                        .addTo(map)
                        .bindPopup(`<b>${station.name}</b><br>${station.distance} away`);
                });

                // Add current location marker (driver)
                const currentLocationIcon = L.divIcon({
                    className: 'current-location-marker',
                    html: '<div style="background: #FF9500; width: 16px; height: 16px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>',
                    iconSize: [16, 16],
                    iconAnchor: [8, 8]
                });

                L.marker(driverLocation, { icon: currentLocationIcon })
                    .addTo(map)
                    .bindPopup('<b>Your Location</b>');

                // Force map to resize after initialization and fit bounds
                setTimeout(() => {
                    map.invalidateSize();
                    // Fit map to show driver and nearest station
                    const bounds = L.latLngBounds([driverLocation, petrosBatuKawa]);
                    map.fitBounds(bounds.pad(0.3));
                }, 200);

                // Also invalidate on window resize
                window.addEventListener('resize', () => {
                    if (map) map.invalidateSize();
                });
            } catch (error) {
                console.error('Map initialization error:', error);
            }
        }

        function nfcTapped() {
            // Show loading screen
            navigateTo('screen-loading');

            // Rotate through motivational messages
            let messageIndex = 0;
            const messageInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % motivationalMessages.length;
                document.getElementById('motivationalText').textContent = `"${motivationalMessages[messageIndex]}"`;
            }, 2000);

            // Simulate CMS processing
            setTimeout(() => {
                clearInterval(messageInterval);
                generateQRCode();
            }, 4000);
        }

        function generateQRCode() {
            // Generate transaction data
            const txnId = 'TXN-' + Math.floor(Math.random() * 100000);
            transactionData = {
                txnId: txnId,
                driverId: 'DRV-001',
                vehicleId: 'ABC-1234',
                maxAmount: '250L',
                fuelProduct: 'Diesel',
                timestamp: new Date().toISOString()
            };

            document.getElementById('txnId').textContent = txnId.replace('TXN-', '');

            // Clear previous QR code
            const qrContainer = document.getElementById('qrCodeDisplay');
            qrContainer.innerHTML = '';

            // Generate QR code with proper size
            new QRCode(qrContainer, {
                text: JSON.stringify(transactionData),
                width: 220,
                height: 220,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });

            // Start QR timer (5 minutes)
            startQRTimer(300);

            // Show QR screen
            navigateTo('screen-qr');

            // Simulate cashier scanning after 8 seconds (give user time to see it)
            setTimeout(() => {
                qrScanned();
            }, 8000);
        }

        function startQRTimer(seconds) {
            if (qrTimerInterval) clearInterval(qrTimerInterval);

            let remaining = seconds;
            qrTimerInterval = setInterval(() => {
                remaining--;
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                document.getElementById('qrTimer').textContent = `${mins}:${String(secs).padStart(2, '0')}`;

                if (remaining <= 0) {
                    clearInterval(qrTimerInterval);
                    cancelTransaction();
                }
            }, 1000);
        }

        function qrScanned() {
            // Stop QR timer
            if (qrTimerInterval) clearInterval(qrTimerInterval);

            // Show loading for CMS validation
            navigateTo('screen-loading');
            document.getElementById('motivationalText').textContent = '"Validating your authorization..."';

            // Simulate CMS approval
            setTimeout(() => {
                navigateTo('screen-approval');
            }, 2000);
        }

        function simulateFueling() {
            // Show loading during fueling
            navigateTo('screen-loading');
            document.getElementById('motivationalText').textContent = '"Fueling in progress..."';

            // Simulate fueling completion after 5 seconds
            setTimeout(() => {
                generateReceipt();
            }, 5000);
        }

        function generateReceipt() {
            // Generate random receipt data
            const volume = (Math.random() * 50 + 20).toFixed(1);
            const pricePerLiter = 3.50;
            const total = (volume * pricePerLiter).toFixed(2);

            const now = new Date();
            const receiptNo = `RCP-${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}-${Math.floor(Math.random() * 1000)}`;
            const dateTime = `${now.getDate()} ${now.toLocaleString('en-US', { month: 'short' })} ${now.getFullYear()}, ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;

            document.getElementById('receiptNo').textContent = receiptNo;
            document.getElementById('receiptTxnId').textContent = transactionData.txnId || 'TXN-12345';
            document.getElementById('receiptDateTime').textContent = dateTime;
            document.getElementById('receiptVolume').textContent = `${volume}L`;
            document.getElementById('receiptTotal').textContent = total;

            // Add to history
            transactionHistory.unshift({
                id: transactionData.txnId || `TXN-${Date.now()}`,
                receiptNo: receiptNo,
                station: 'Petros Batu Kawa',
                date: now,
                dateString: `${now.getDate()} ${now.toLocaleString('en-US', { month: 'short' })} ${now.getFullYear()}`,
                timeString: `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`,
                volume: volume,
                amount: total,
                fuelType: 'Diesel',
                vehicle: 'ABC-1234'
            });

            navigateTo('screen-receipt');
        }

        function cancelTransaction() {
            if (qrTimerInterval) clearInterval(qrTimerInterval);
            navigateTo('screen-home');
        }

        function downloadReceipt() {
            alert('Receipt download functionality would be implemented here.\n\nIn production, this would:\n- Generate a PDF receipt\n- Save it to device storage\n- Offer sharing options (email, WhatsApp, etc.)');
        }

        // ========== INITIALIZATION ==========
        window.onload = function () {
            generateSampleHistory();
            generateSampleInbox();
            updateInboxBadge();
            // Map will be initialized when home screen is shown
        };
    </script>
</body>

</html>